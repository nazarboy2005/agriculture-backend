[phases.setup]
nixPkgs = ["maven", "openjdk17"]

[phases.install]
cmds = ["mvn clean install -DskipTests"]

[phases.build]
cmds = ["mvn clean package -DskipTests", "echo 'Build completed, checking JAR file...'", "pwd", "ls -la", "ls -la target/", "find . -name '*.jar' -type f", "echo 'Checking for agriculture-backend JAR...'", "if [ -f target/agriculture-backend-0.0.1-SNAPSHOT.jar ]; then echo 'SUCCESS: JAR file found at target/agriculture-backend-0.0.1-SNAPSHOT.jar'; ls -la target/agriculture-backend-0.0.1-SNAPSHOT.jar; else echo 'ERROR: JAR file not found at expected location!'; echo 'Available JAR files:'; find . -name '*.jar' -type f; exit 1; fi"]

[start]
cmd = "sh -c 'echo \"Current directory: $(pwd)\"; echo \"Contents: $(ls -la)\"; echo \"Target contents: $(ls -la target/ 2>/dev/null || echo \\\"Target not found\\\")\"; echo \"Looking for JAR...\"; find . -name \"*.jar\" -type f 2>/dev/null || echo \"No JAR files found\"; if [ -f target/agriculture-backend-0.0.1-SNAPSHOT.jar ]; then echo \"JAR found, starting...\"; java -jar target/agriculture-backend-0.0.1-SNAPSHOT.jar --server.port=$PORT; else echo \"JAR not found, trying alternative locations...\"; JAR_FILE=$(find . -name \"agriculture-backend*.jar\" -type f | head -1); if [ -n \"$JAR_FILE\" ]; then echo \"Found JAR at: $JAR_FILE\"; java -jar \"$JAR_FILE\" --server.port=$PORT; else echo \"No JAR file found anywhere!\"; exit 1; fi; fi'"
